<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Real-Time Audio Translator</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:400,500,700&display=swap" rel="stylesheet"/>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="krish.css" />
  <style>
    body { font-family: 'Roboto', Arial, sans-serif; background: #f7f8fa; color: #23272b; margin: 0; }
    .container { max-width: 540px; margin: 3rem auto; background: #fff; border-radius: 16px; box-shadow: 0 3px 30px 0 #6680aa22; padding: 2rem; }
    h2 { color: #007aff; text-align: center; margin-bottom: 1.5rem; }
    .upload-section { display: flex; flex-direction: column; align-items: center; gap: 1.2rem; }
    .upload-label { background: #e6f3fd; color: #007aff; border: 2px dashed #007aff; border-radius: 10px; padding: 1.2rem 2rem; cursor: pointer; transition: background 0.2s; text-align: center; }
    .upload-label:hover { background: #dbeafe; }
    input[type="file"] { display: none; }
    select, button { font-size: 1.1rem; margin: 0.5rem 0; }
    .convert-btn { background: #007aff; color: #fff; border: none; border-radius: 8px; padding: 0.7rem 2.2rem; font-size: 1.1rem; cursor: pointer; transition: background 0.2s; }
    .convert-btn:hover { background: #329fff; }
    .back-link { display: inline-block; margin-top: 1.5rem; color: #007aff; text-decoration: none; font-weight: 500; font-size: 1.1rem; transition: color 0.2s; }
    .back-link:hover { text-decoration: underline; color: #005fa3; }
    .output-section { margin-top: 2rem; }
    .transcript, .translation { background: #f4f7fa; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; font-size: 1rem; }
    .speaker { color: #007aff; font-weight: 500; }
    .timestamp { color: #888; font-size: 0.95em; margin-right: 0.7em; }
    audio { width: 100%; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="container">
    <h2><i class='bx bx-microphone'></i> Real-Time Audio Translator</h2>
    <form id="audio-form" class="upload-section">
      <label class="upload-label" for="audio-input">
        <i class='bx bx-upload'></i> Upload audio file (MP3, WAV)
        <input type="file" id="audio-input" accept="audio/*" />
      </label>
      <label>Input Language:
        <select id="input-lang">
          <option value="en">English</option>
          <option value="hi">Hindi</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="zh">Chinese</option>
        </select>
      </label>
      <label>Output Language:
        <select id="output-lang">
          <option value="hi">Hindi</option>
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="zh">Chinese</option>
        </select>
      </label>
      <button type="button" class="convert-btn" id="convert-btn">Translate & Transcribe</button>
      <div id="status" style="margin-top:1rem;color:#007aff;"></div>
    </form>
    <div class="output-section" id="output-section" style="display:none;">
      <div class="transcript" id="transcript"></div>
      <div class="translation" id="translation"></div>
      <audio id="tts-audio" controls style="display:none;"></audio>
    </div>
    <a href="app.html" class="back-link"><i class='bx bx-arrow-back'></i> Back to Home</a>
  </div>
  <script>
    const audioInput = document.getElementById('audio-input');
    const convertBtn = document.getElementById('convert-btn');
    const inputLang = document.getElementById('input-lang');
    const outputLang = document.getElementById('output-lang');
    const status = document.getElementById('status');
    const transcriptDiv = document.getElementById('transcript');
    const translationDiv = document.getElementById('translation');
    const outputSection = document.getElementById('output-section');
    const ttsAudio = document.getElementById('tts-audio');
    let selectedFile = null;

    audioInput.addEventListener('change', function() {
      selectedFile = this.files[0];
      status.textContent = '';
      outputSection.style.display = 'none';
      transcriptDiv.textContent = '';
      translationDiv.textContent = '';
      ttsAudio.style.display = 'none';
    });

    convertBtn.addEventListener('click', function() {
      if (!selectedFile) {
        alert('Please upload an audio file first.');
        return;
      }
      status.textContent = 'Processing audio, please wait...';
      const formData = new FormData();
      formData.append('file', selectedFile);
      formData.append('input_lang', inputLang.value);
      formData.append('output_lang', outputLang.value);
      fetch('http://localhost:5000/audio_translate', {
        method: 'POST',
        body: formData
      })
      .then(response => {
        if (!response.ok) throw new Error('Server error: ' + response.status);
        return response.json();
      })
      .then(data => {
        // Transcript with speaker and timestamp
        transcriptDiv.innerHTML = '';
        data.transcript.forEach(seg => {
          transcriptDiv.innerHTML += `<span class="timestamp">[${seg.start} - ${seg.end}]</span> <span class="speaker">${seg.speaker}:</span> ${seg.text}<br/>`;
        });
        // Translation
        translationDiv.textContent = data.translation;
        // TTS audio
        if (data.tts_url) {
          ttsAudio.src = data.tts_url;
          ttsAudio.style.display = 'block';
        } else {
          ttsAudio.style.display = 'none';
        }
        outputSection.style.display = 'block';
        status.textContent = 'Done!';
      })
      .catch(err => {
        status.textContent = 'Error: ' + err.message;
        outputSection.style.display = 'none';
      });
    });
  </script>
</body>
</html>
